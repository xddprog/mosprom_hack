# Тестовая база данных

Этот модуль предоставляет современные инструменты для создания полностью рандомной тестовой базы данных с использованием SQLAlchemy 2.0.

## Особенности

- ✅ **Полностью рандомные данные** - использует библиотеку Faker для генерации реалистичных данных
- ✅ **Современный SQLAlchemy 2.0** - использует новейшие подходы и лучшие практики
- ✅ **Асинхронная работа** - все операции выполняются асинхронно для лучшей производительности
- ✅ **Модульная архитектура** - каждая сущность создается отдельной функцией
- ✅ **Настраиваемые объемы данных** - легко изменить количество создаваемых записей
- ✅ **Правильные связи** - создает реалистичные связи между сущностями
- ✅ **Временные метки** - генерирует данные с реалистичным распределением по времени

## Установка зависимостей

```bash
pip install faker==24.0.0
```

## Использование

### 1. Программное использование

```python
from backend.infrastructure.database.connection import get_async_session
from backend.utils.test_db import init_tables, clear_database, reset_database

# Создать тестовые данные
async with get_async_session() as session:
    await init_tables(session)

# Очистить базу данных
async with get_async_session() as session:
    await clear_database(session)

# Полностью сбросить и создать заново
async with get_async_session() as session:
    await reset_database(session)
```

### 2. Использование скрипта

```bash
# Создать тестовые данные
python init_test_db.py

# Полностью сбросить и создать заново
python init_test_db.py --reset

# Только очистить базу данных
python init_test_db.py --clear
```

## Конфигурация

В файле `test_db.py` можно настроить количество создаваемых записей:

```python
CONFIG = {
    'companies_count': 50,      # Количество компаний
    'universities_count': 20,   # Количество университетов
    'users_count': 200,         # Количество пользователей
    'students_count': 500,      # Количество студентов
    'tags_count': 100,          # Количество тегов
    'vacancies_count': 300,     # Количество вакансий
    'applications_count': 2000, # Количество заявок
}
```

## Генерируемые данные

### Компании
- Случайные названия компаний
- Различные отрасли (IT, финансы, здравоохранение и т.д.)
- Случайные URL сайтов
- Случайные иконки (опционально)

### Университеты
- Случайные названия университетов
- Различные типы (Университет, Институт, Академия и т.д.)
- Случайные URL сайтов

### Пользователи
- Случайные имена (русские и английские)
- Случайные email адреса
- Различные роли (ADMIN, COMPANY, UNIVERSITY, STUDENT)
- Связи с компаниями или университетами

### Студенты
- Случайные имена
- Случайные email адреса
- Случайные курсы (1-6)
- Случайные специализации
- Связи с университетами

### Теги
- Технологические стеки (Python, JavaScript, Java и т.д.)
- Фреймворки (React, Django, Spring Boot и т.д.)
- Базы данных (PostgreSQL, MongoDB, Redis и т.д.)
- Облачные платформы (AWS, Google Cloud, Azure и т.д.)
- Инструменты (Docker, Kubernetes, Git и т.д.)

### Вакансии
- Случайные названия должностей
- Связи с компаниями
- Случайные регионы
- Различные уровни опыта
- Реалистичные зарплаты (зависят от опыта)
- Различные форматы работы (удаленно, офис, гибрид)
- Случайные обязанности, требования и условия

### Заявки
- Случайные имена кандидатов
- Случайные email адреса
- Случайные ссылки на резюме
- Различные статусы с весовым распределением
- Связи с вакансиями

## Временные метки

Все данные создаются с реалистичными временными метками:
- Больше данных в последние месяцы (весовое распределение)
- Случайное время в течение дня
- Правильные `created_at` и `updated_at` для завершенных заявок

## Связи между сущностями

- **Вакансии ↔ Теги**: 3-6 случайных тегов на вакансию + популярные теги
- **Студенты ↔ Теги**: 2-5 случайных тегов на студента
- **Пользователи ↔ Компании/Университеты**: случайные связи
- **Студенты ↔ Университеты**: каждый студент привязан к университету
- **Заявки ↔ Вакансии**: случайные связи

## Производительность

- Использует `session.flush()` для получения ID без коммита
- Батчевые операции для создания связей
- Проверка существования связей перед созданием
- Асинхронные операции для лучшей производительности

## Обработка ошибок

- Автоматический rollback при ошибках
- Проверка существования данных перед созданием
- Детальное логирование процесса
- Graceful handling дублирующихся тегов

## Расширение

Легко добавить новые типы данных или изменить логику генерации:

1. Добавить новые списки в конфигурацию
2. Создать функцию `generate_random_*()`
3. Создать функцию `create_*()` для создания в БД
4. Добавить вызов в `init_tables()`

